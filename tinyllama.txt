# streamlit_app.py
import streamlit as st
import requests
from pyvis.network import Network
import streamlit.components.v1 as components

# Set up the Streamlit sidebar
st.sidebar.title("Event Status Visualization")
event_id = st.sidebar.text_input("Enter Event ID:")

if st.sidebar.button("Get Event Status"):
    if event_id:
        response = requests.get(f"http://localhost:5000/events/{event_id}")
        if response.status_code == 200:
            event_data = response.json()
            
            # Create a Network object
            net = Network(height='600px', width='100%', bgcolor='#222222', font_color='white')

            # Add nodes and edges based on the event data
            for flow in event_data['eventFlow']:
                publisher = flow['publisherApp']
                net.add_node(publisher, label=publisher, color='green')

                for consumer in flow['publishedTo']:
                    consumer_app = consumer['consumerApp']
                    status = consumer['status']
                    color = 'green' if status == 'SUCCESS' else 'red'
                    net.add_node(consumer_app, label=consumer_app, color=color)
                    net.add_edge(publisher, consumer_app, color=color)

            # Generate the HTML file
            net.save_graph('event_status_graph.html')

            # Display the graph
            HtmlFile = open('event_status_graph.html', 'r', encoding='utf-8')
            source_code = HtmlFile.read()
            components.html(source_code, height=700, width=1000)
        else:
            st.error("Event not found")
    else:
        st.error("Please enter a valid Event ID")
